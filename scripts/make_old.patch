From 698a41eef557df81fc32a0ffb38d3259b9dd103a Mon Sep 17 00:00:00 2001
From: Stephen Moore <stephen@delfick.com>
Date: Mon, 1 Apr 2024 09:57:28 +1100
Subject: [PATCH] WIP: Make it use older django-stubs

---
 extended_mypy_django_plugin/plugin/_dependencies.py | 2 +-
 mypy.ini                                            | 3 +--
 tools/venv                                          | 2 +-
 3 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/extended_mypy_django_plugin/plugin/_dependencies.py b/extended_mypy_django_plugin/plugin/_dependencies.py
index 1250878..1b98f46 100644
--- a/extended_mypy_django_plugin/plugin/_dependencies.py
+++ b/extended_mypy_django_plugin/plugin/_dependencies.py
@@ -40,7 +40,7 @@ class Dependencies:
     @property
     def model_modules(self) -> dict[str, dict[str, type[models.Model]]]:
         model_modules = self.plugin.django_context.model_modules
-        return model_modules
+        return {k: {cls.__name__: cls for cls in known} for k, known in model_modules.items()}
 
     def for_file(self, fullname: str, super_deps: DepList) -> DepList:
         deps = list(super_deps)
diff --git a/mypy.ini b/mypy.ini
index c305a5b..3f601bf 100644
--- a/mypy.ini
+++ b/mypy.ini
@@ -12,8 +12,7 @@ exclude = (?x)(
     )
 
 plugins =
-    extended_mypy_django_plugin.main,
-    mypy.plugins.proper_plugin
+    extended_mypy_django_plugin.main
 
 [mypy.plugins.django-stubs]
 project_identifier = extended_django_setting
diff --git a/tools/venv b/tools/venv
index 66477ce..f5d8599 100755
--- a/tools/venv
+++ b/tools/venv
@@ -19,7 +19,7 @@ manager.add_local_dep(
     "{here}",
     "..",
     version_file=("extended_mypy_django_plugin", "version.py"),
-    name="extended_mypy_django_plugin[stubs-latest,tests]=={version}",
+    name="extended_mypy_django_plugin[stubs-older,tests]=={version}",
 )
 
 manager.add_local_dep(
-- 
2.42.1

