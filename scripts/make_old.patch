From d5815f8500af90e08efeb09b9976b650765d902b Mon Sep 17 00:00:00 2001
From: Stephen Moore <stephen@delfick.com>
Date: Mon, 1 Apr 2024 13:56:22 +1100
Subject: [PATCH] WIP: Make it for the old

---
 extended_mypy_django_plugin/plugin/_dependencies.py | 2 +-
 mypy.ini                                            | 3 +--
 tools/venv                                          | 2 +-
 3 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/extended_mypy_django_plugin/plugin/_dependencies.py b/extended_mypy_django_plugin/plugin/_dependencies.py
index 0e99dca..b5e94ae 100644
--- a/extended_mypy_django_plugin/plugin/_dependencies.py
+++ b/extended_mypy_django_plugin/plugin/_dependencies.py
@@ -41,7 +41,7 @@ class Dependencies:
     @property
     def model_modules(self) -> dict[str, dict[str, type[models.Model]]]:
         model_modules = self.plugin.django_context.model_modules
-        return model_modules
+        return {k: {cls.__name__: cls for cls in known} for k, known in model_modules.items()}
 
     def is_model_known(self, fullname: str) -> bool:
         for mod, known in self.plugin.dependencies.model_modules.items():
diff --git a/mypy.ini b/mypy.ini
index c305a5b..3f601bf 100644
--- a/mypy.ini
+++ b/mypy.ini
@@ -12,8 +12,7 @@ exclude = (?x)(
     )
 
 plugins =
-    extended_mypy_django_plugin.main,
-    mypy.plugins.proper_plugin
+    extended_mypy_django_plugin.main
 
 [mypy.plugins.django-stubs]
 project_identifier = extended_django_setting
diff --git a/tools/venv b/tools/venv
index b84fdfa..1bbec65 100755
--- a/tools/venv
+++ b/tools/venv
@@ -19,7 +19,7 @@ manager.add_local_dep(
     "{here}",
     "..",
     version_file=("extended_mypy_django_plugin", "version.py"),
-    name="extended_mypy_django_plugin[stubs-latest,tests]=={version}",
+    name="extended_mypy_django_plugin[stubs-older,tests]=={version}",
 )
 
 manager.add_local_dep(
-- 
2.42.1

